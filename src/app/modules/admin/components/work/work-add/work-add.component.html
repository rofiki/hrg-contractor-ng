<app-header></app-header>

<div class="container main-body">
    <div class="h3">
        งานรับเหมาพาดสายสื่อสาร
        <div class="text-muted h6 fw-normal">
            <small>บันทึกงานรับเหมาพาดสายสื่อสาร</small>
        </div>
    </div>
    <div class="bg-white border mt-4 p-4 shadow">
        <form [formGroup]="createForm" (ngSubmit)="onSubmit(template)" enctype="multipart/form-data">
            <div class="row">
                <div class="col-md-6  pe-4">

                    <div class="mb-3">
                        <label for="" class="form-label m-0">เลขที่ Work <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="" formControlName="work_code">
                        <div
                            *ngIf="(createForm.controls['work_code'].hasError('required') && (createForm.get('work_code')?.dirty || createForm.get('work_code')?.touched))">
                            <small class="message-error"><i class="fa-solid fa-square-xmark"></i> เลขที่ Work
                                ห้ามว่าง</small>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="" class="form-label m-0">ผู้จ้างงาน (ลูกค้า) <span
                                class="text-danger">*</span></label>

                                <select *ngIf="cusItems && cusItems.data" name="customer_id" id="customer_id" class="form-control" formControlName="customer_id">
                                    <option value="">- เลือก -</option>
                                    <ng-container *ngFor="let element of cusItems.data">
                                        <option value="{{ element.id }}"> {{ element.name }}</option>
                                    </ng-container>
                                </select>                                
                        <div
                            *ngIf="(createForm.controls['customer_id'].hasError('required') && (createForm.get('customer_id')?.dirty || createForm.get('customer_id')?.touched))">
                            <small class="message-error"><i class="fa-solid fa-square-xmark"></i> กรุณาเลือก ผู้จ้างงาน (ลูกค้า)</small>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-3">
                            <label for="">ปีที่รับงาน</label>
                            <select id="work_year" name="work_year" class="form-control" formControlName="work_year">
                                <option value="2023" selected>2023</option>
                                <option value="2022">2022</option>
                                <option value="2021">2021</option>
                                <option value="2020">2020</option>
                                <option value="2019">2019</option>
                                <option value="2018">2018</option>
                                <option value="2017">2017</option>
                                <option value="2016">2016</option>
                            </select>
                            
                        </div>
                        <div class="col-md-9">
                            <label for="">สถานที่ </label>
                            <input type="text" class="form-control" id="work_place" name="work_place"
                                formControlName="work_place">
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="" class="form-label m-0">รายละเอียด </label>
                        <input type="text" class="form-control" id="" formControlName="work_detail">
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="">วันที่รับงาน <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" formControlName="work_job_start" bsDatepicker>
                            <div
                                *ngIf="(createForm.controls['work_job_start'].hasError('required') && (createForm.get('work_job_start')?.dirty || createForm.get('work_job_start')?.touched))">
                                <small class="message-error"><i class="fa-solid fa-square-xmark"></i> วันที่รับงาน
                                    ห้ามว่าง</small>
                            </div>
                            
                        </div>
                        <div class="col-md-6">
                            <label for="">วันที่เสร็จงาน </label>
                            <input type="text" class="form-control" formControlName="work_job_finish" bsDatepicker>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="inputWorkYear">ต้นทาง </label>
                            <input type="text" class="form-control" formControlName="work_place_start">
                        </div>
                        <div class="col-md-6">
                            <label for="inputWorkPlace">พิกัดต้นทาง </label>
                            <input type="text" class="form-control" formControlName="work_place_start_latlong">
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="inputWorkYear">ปลายทาง </label>
                            <input type="text" class="form-control" formControlName="work_place_end">
                        </div>
                        <div class="col-md-6">
                            <label for="inputWorkPlace">พิกัดปลายทาง </label>
                            <input type="text" class="form-control" formControlName="work_place_end_latlong">
                        </div>
                    </div>

                </div>

                <div class="col-md-6 border-start ps-4">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="inputWorkYear">ระยะทาง (เมตร) </label>
                            <input type="text" class="form-control" formControlName="work_distance">
                            <div
                                *ngIf="(createForm.controls['work_distance'].hasError('pattern') && (createForm.get('work_distance')?.dirty || createForm.get('work_distance')?.touched))">
                                <small class="message-error"><i class="fa-solid fa-square-xmark"></i>
                                    ตัวเลขเท่านั้น</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="inputWorkPlace">ราคางาน (บาท) </label>
                            <input type="text" class="form-control" formControlName="work_price">
                            <div
                                *ngIf="(createForm.controls['work_price'].hasError('pattern') && (createForm.get('work_price')?.dirty || createForm.get('work_price')?.touched))">
                                <small class="message-error"><i class="fa-solid fa-square-xmark"></i>
                                    ตัวเลขเท่านั้น</small>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="" class="form-label m-0">หมายเหตุ </label>
                        <input type="text" class="form-control" formControlName="work_note">
                    </div>
                    <div class="mb-3">
                        <label for="" class="form-label m-0">เอกสารเปิดงาน </label>
                        <input type="file" class="form-control file-upload" onchange="console.log(event.target.files)">
                    </div>
                    <div class="mb-3">
                        <label for="" class="form-label m-0">แบบงาน </label>
                        <input type="file" class="form-control file-upload" onchange="console.log(event.target.files)">
                    </div>
                    <div class="mb-3">
                        <label for="" class="form-label m-0">สถานะ </label>
                        <select class="form-control" formControlName="work_status">
                            <option value="">- เลือก -</option>
                            <ng-container *ngFor="let status of statusList">
                                <option value="{{status.value}}">{{status.label}}</option>
                            </ng-container>
                        </select>
                        <div
                        *ngIf="(createForm.controls['work_status'].hasError('required') && (createForm.get('work_status')?.dirty || createForm.get('work_status')?.touched))">
                        <small class="message-error"><i class="fa-solid fa-square-xmark"></i> กรุณาเลือกสถานะ</small>
                    </div>
                    </div>
                </div>
                <div class="col-md-12">
                    <input type="hidden" formControlName="token">
                    <button type="submit" class="btn btn-primary btn-sm me-1" [disabled]="createForm.invalid"><i
                            class="fa-regular fa-floppy-disk"></i> บันทึก </button>
                    <button class="btn btn-secondary btn-sm " [routerLink]="['/work/status']"><i
                            class="fa-solid fa-arrow-left"></i> กลับ</button>
                </div>


            </div>
        </form>

    </div>
</div>
<ng-template #template>
    <div class="modal-body text-center">
        <p>ยืนยันเพื่มข้อมูล</p>

        <div *ngIf="(isProcess == true) then showSaveLoading"></div>
        <ng-template #showSaveLoading>
            <p><i class="fa-solid fa-circle-notch fa-spin"></i> กำลังบันทึก...</p>
        </ng-template>

        <button type="button" class="btn btn-primary btn-sm me-1" [disabled]="(isProcess == true)"
            (click)="confirm()">ยืนยัน</button>
        <button type="button" class="btn btn-secondary btn-sm" [disabled]="(isProcess == true)"
            (click)="decline()">ยกเลิก</button>

    </div>
</ng-template>
<app-footer></app-footer>